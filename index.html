<!DOCTYPE html>
<meta charset="utf-8" />
<style>
  .container {
    display: flex;
    justify-content: space-between;
    position: relative; /* Add relative positioning to the container */
  }

  .map,
  .form {
    width: 48%; /* Adjust the width as needed */
  }

  .outline {
    fill: none;
    stroke: #000;
    stroke-width: 1.5px;
  }
  .form form {
    display: flex;
    flex-direction: column;
  }

  .popup {
    display: none;
    flex-direction: column;
    padding: 10px;
    background-color: white;
    border: 1px solid #ccc;
    z-index: 999;
    position: absolute; /* Set absolute positioning */
    top: 0; /* Align with the top of the container */
    left: 100%; /* Position to the right of the container */
  }

  .feature {
    fill: #ccc;
  }

  .mesh {
    fill: none;
    stroke: #fff;
    stroke-width: 0.5px;
    stroke-linejoin: round;
  }

  path {
    fill: #ccc;
    stroke: #fff;
    stroke-width: 0.5px;
  }

  .county {
    fill: #ccc;
    stroke: #fff;
    stroke-width: 0.5px;
  }

  .county:hover {
    fill: orange;
  }

  .county-label {
    font-size: 24px; /* Adjust the font size as needed */
    fill: black;
    display: none;
  }
</style>
<body>
  <div class="container">
    <div class="map"></div>
    <div class="form">
      <!-- Popup form -->
      <div id="popup" class="popup">
        <h3>Contact Form</h3>
        <form id="contactForm">
          <label for="name">Name:</label>
          <input type="text" id="name" name="name" required />

          <label for="email">Email:</label>
          <input type="email" id="email" name="email" required />

          <label for="phone">Phone:</label>
          <input type="tel" id="phone" name="phone" required />

          <label for="address">Address:</label>
          <input type="text" id="address" name="address" required />

          <button type="button" onclick="submitForm()">Submit</button>
        </form>
        <div id="successMessage" style="display: none">
          We will contact you shortly.
        </div>
      </div>
    </div>
  </div>
  <script src="//d3js.org/d3.v3.min.js"></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>

  <script>
    var width = 600; /* Adjust the width as needed */
    var height = 800; /* Adjust the height as needed */

    var projection = d3.geo.albers();
    var path = d3.geo.path().projection(projection);
    var countyNameMap = new Map(); // Declare countyNameMap here

    var svg = d3
      .select("body")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    // Load us.json first
    d3.json("us.json", function (error, us) {
      if (error) throw error;

      var states = topojson.feature(us, us.objects.states),
        state = states.features.filter(function (d) {
          return d.id === 0o6;
        })[0];

      projection.scale(1).translate([0, 0]);

      var b = path.bounds(state),
        s =
          0.95 /
          Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height),
        t = [
          (width - s * (b[1][0] + b[0][0])) / 2,
          (height - s * (b[1][1] + b[0][1])) / 2,
        ];

      projection.scale(s).translate(t);

      svg
        .append("path")
        .datum(
          topojson.mesh(us, us.objects.states, function (a, b) {
            return a !== b;
          })
        )
        .attr("class", "mesh")
        .attr("d", path);

      svg
        .append("path")
        .datum(state)
        .attr("class", "outline")
        .attr("d", path)
        .attr("id", "land");

      svg
        .append("clipPath")
        .attr("id", "clip-land")
        .append("use")
        .attr("xlink:href", "#land");

      // Load counties.json after us.json
      d3.json("counties.json", function (error, counties) {
        if (error) throw error;

        counties.forEach(function (county) {
          countyNameMap.set(county.id, county.properties.name);
        });

        // Create a group for counties
        var countiesGroup = svg.append("g").attr("class", "counties-group");

        // Append counties
        countiesGroup
          .selectAll(".county")
          .data(topojson.feature(us, us.objects.counties).features)
          .enter()
          .append("path")
          .attr("d", path)
          .attr("county-id", function (d) {
            return d.id;
          })
          .attr("clip-path", "url(#clip-land)")
          .attr("class", "county")
          .on("click", function (d) {
            var countyName = countyNameMap.get("0" + d.id);
            if (countyName) {
              d3.select("#popup")
                .style("display", "flex")
                .style("left", projection(d3.geo.centroid(d))[0] + "px")
                .style("top", projection(d3.geo.centroid(d))[1] + "px");

              // Set the county name in the form
              document.getElementById("name").value = countyName;
            } else {
              console.log("No name property found for county:", d);
            }
          })
          .on("mouseover", function (d) {
            var countyName = countyNameMap.get("0" + d.id);
            if (countyName) {
              d3.select(".county-label")
                .text(countyName)
                .attr(
                  "transform",
                  "translate(" + projection(d3.geo.centroid(d)) + ")"
                )
                .style("display", "flex");
            } else {
              console.log("No name property found for county:", d);
            }
          })
          .on("mouseout", function () {
            d3.select(".county-label").style("display", "none");
          });

        // Create a group for county labels
        var labelsGroup = svg.append("g").attr("class", "labels-group");

        // Append county labels
        labelsGroup
          .selectAll(".county-label")
          .data(topojson.feature(us, us.objects.counties).features)
          .enter()
          .append("text")
          .attr("class", "county-label")
          .style("display", "none"); // Initially hide labels
      });
    });

    // Function to submit the form
    function submitForm() {
      // You can add logic to send the form data to the server for email processing
      // For demonstration purposes, we'll just show a success message and hide the form

      // Show success message
      document.getElementById("successMessage").style.display = "block";

      // Hide the form after submission
      document.getElementById("popup").style.display = "none";
    }
  </script>
</body>
