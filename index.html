<!DOCTYPE html>
<meta charset="utf-8" />
<style>
  .outline {
    fill: none;
    stroke: #000;
    stroke-width: 1.5px;
  }

  .feature {
    fill: #ccc;
  }

  .mesh {
    fill: none;
    stroke: #fff;
    stroke-width: 0.5px;
    stroke-linejoin: round;
  }

  path {
    fill: #ccc;
    stroke: #fff;
    stroke-width: 0.5px;
  }

  .county {
    fill: #ccc;
    stroke: #fff;
    stroke-width: 0.5px;
  }

  .county:hover {
    fill: orange;
  }

  .county-label {
    font-size: 10px;
    fill: black;
    display: none;
  }
</style>
<body>
  <script src="//d3js.org/d3.v3.min.js"></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>
  <script>
    var width = 960,
      height = 500;

    var projection = d3.geo.albers();

    var path = d3.geo.path().projection(projection);

    var svg = d3
      .select("body")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    // Load us.json first
    d3.json("us.json", function (error, us) {
      if (error) throw error;

      var states = topojson.feature(us, us.objects.states),
        state = states.features.filter(function (d) {
          return d.id === 0o6;
        })[0];

      projection.scale(1).translate([0, 0]);

      var b = path.bounds(state),
        s =
          0.95 /
          Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height),
        t = [
          (width - s * (b[1][0] + b[0][0])) / 2,
          (height - s * (b[1][1] + b[0][1])) / 2,
        ];

      projection.scale(s).translate(t);

      svg
        .append("path")
        .datum(
          topojson.mesh(us, us.objects.states, function (a, b) {
            return a !== b;
          })
        )
        .attr("class", "mesh")
        .attr("d", path);

      svg
        .append("path")
        .datum(state)
        .attr("class", "outline")
        .attr("d", path)
        .attr("id", "land");

      svg
        .append("clipPath")
        .attr("id", "clip-land")
        .append("use")
        .attr("xlink:href", "#land");

      // Load counties.json after us.json
      d3.json("counties.json", function (error, counties) {
        if (error) throw error;

        // Create a map of county names based on county ID
        var countyNameMap = new Map();
        counties.forEach(function (county) {
          countyNameMap.set(county.id, county.properties.name);
        
        });
        console.log(countyNameMap);

        // Create a group for counties
        var countiesGroup = svg.append("g").attr("class", "counties-group");

        // Append counties
        countiesGroup
          .selectAll(".county")
          .data(topojson.feature(us, us.objects.counties).features)
          .enter()
          .append("path")
          .attr("d", path)
          .attr("county-id", function (d) {
            return d.id;
          })
          .attr("clip-path", "url(#clip-land)")
          .attr("class", "county")
          .on("mouseover", function (d) {
            var countyName = countyNameMap.get("0" + d.id);
            if (countyName) {
              d3.select(".county-label")
                .text(countyName)
                .attr("transform", "translate(" + projection(d3.geo.centroid(d)) + ")")
                .style("display", "block");
            } else {
              console.log("No name property found for county:", d);
            }
          })
          .on("mouseout", function () {
            d3.select(".county-label").style("display", "none");
          });

        // Create a group for county labels
        var labelsGroup = svg.append("g").attr("class", "labels-group");

        // Append county labels
        labelsGroup
          .selectAll(".county-label")
          .data(topojson.feature(us, us.objects.counties).features)
          .enter()
          .append("text")
          .attr("class", "county-label")
          .style("display", "none"); // Initially hide labels
      });
    });
  </script>
</body>
